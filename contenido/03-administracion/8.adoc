= Fundamentos de la Administraci√≥n Linux - Gesti√≥n de Usuarios y Grupos üßë‚Äçüíªüîí
Alex Callejas
:doctype: article
:revdate: Oct 9, 2025
:keywords: linux, root, sudo, user, group, administraci√≥n

image::images/portada_8.png[Fundamentos de la Administraci√≥n Linux - Gesti√≥n de Usuarios y Grupos]

En el coraz√≥n de la administraci√≥n de cualquier sistema operativo *Linux* se encuentra la gesti√≥n de sus usuarios y los grupos a los que pertenecen. Este control es fundamental para garantizar la *seguridad* y establecer los *permisos* de acceso a los recursos.

Si est√°s prepar√°ndote para certificaciones como *LPIC-1*, *LFCS* o *RHCSA*, dominar estas herramientas y entender los archivos de configuraci√≥n subyacentes es crucial. ¬°Vamos a sumergirnos!

== Gesti√≥n de Cuentas de Usuario

El ciclo de vida de un usuario en Linux se maneja principalmente a trav√©s de tres comandos: `useradd`, `usermod` y `userdel`.

=== 1. Creaci√≥n de Usuarios (`useradd`)

El comando `useradd` (o `adduser` en algunas distribuciones) es la herramienta principal para crear una nueva cuenta. Por defecto, crea una entrada en `/etc/passwd`, establece el directorio *home* del usuario y, a menudo, crea un grupo primario con el mismo nombre que el usuario.

*Sintaxis b√°sica:*

[source,bash]
----
$ sudo useradd nombre_usuario
----

*Opciones clave que debes conocer:*

* `-m`: *Crea* el directorio *home* del usuario si no existe (es la opci√≥n por defecto en muchos sistemas).
* `-g`: Especifica el *grupo primario* del usuario (por nombre o GID).
* `-G`: Especifica los *grupos secundarios* adicionales a los que pertenecer√° el usuario (una lista separada por comas).
* `-c`: Agrega un *comentario* o descripci√≥n para la cuenta (por ejemplo, el nombre real del usuario).
* `-s`: Establece el *shell de inicio* del usuario (ejemplo: `/bin/bash` o `/sbin/nologin`).

=== 2. Modificaci√≥n de Usuarios (`usermod`)

Cuando necesites cambiar los atributos de una cuenta existente, `usermod` es tu aliado.

*Sintaxis b√°sica:*

[source,bash]
----
$ sudo usermod [OPCIONES] nombre_usuario
----

*Usos comunes de `usermod`:*

* Cambiar el directorio *home* y mover su contenido: `sudo usermod -m -d /nuevo/home nombre_usuario`
* A√±adir un usuario a un grupo secundario: `sudo usermod -aG nombre_grupo nombre_usuario` (el modificador `-a` de **append** o a√±adir es importante para no sobrescribir los grupos existentes).
* Cambiar el nombre de usuario (¬°peligroso!): `sudo usermod -l nuevo_nombre antiguo_nombre`

=== 3. Eliminaci√≥n de Usuarios (`userdel`)

Para eliminar una cuenta de usuario, utiliza `userdel`.

*Sintaxis b√°sica:*

[source,bash]
----
$ sudo userdel nombre_usuario
----

*Opci√≥n crucial:*

* `-r`: *Elimina* el directorio *home* y el *spool* de correo del usuario (se recomienda usar esta opci√≥n para una limpieza completa). `sudo userdel -r nombre_usuario`

== Gesti√≥n de Grupos en Linux

Los grupos son colecciones de usuarios que comparten los mismos *permisos* de acceso a un conjunto de archivos o recursos.

=== Comandos de Grupo

Al igual que con los usuarios, existen comandos equivalentes para gestionar los grupos:

* *`groupadd`*: Crea un nuevo grupo.
** Ejemplo: `sudo groupadd desarrollo`
* *`groupmod`*: Modifica las propiedades de un grupo.
** Ejemplo: `sudo groupmod -n nuevo_nombre_grupo antiguo_nombre_grupo` (cambiar el nombre)
* *`groupdel`*: Elimina un grupo.
** Ejemplo: `sudo groupdel desarrollo`

== Archivos Clave de Configuraci√≥n üíæ

Los comandos que acabamos de ver no hacen magia; simplemente modifican el contenido de tres archivos de texto planos esenciales. Conocer su estructura es vital para la resoluci√≥n de problemas (troubleshooting).

=== 1. `/etc/passwd` (La Identidad)

Contiene la informaci√≥n b√°sica y no sensible de la cuenta de usuario. Cada l√≠nea representa un usuario y se divide en *siete campos* separados por dos puntos (`:`):

[cols="3*", options="header"]
|===
| Campo | Descripci√≥n | Ejemplo
| *1.* Nombre de usuario | Nombre de inicio de sesi√≥n | `useradmin`
| *2.* Contrase√±a (x) | Suele ser una `x` indicando que la contrase√±a est√° en `/etc/shadow` | `x`
| *3.* ID de Usuario (**UID**) | Identificador √∫nico del usuario (0 es *root*) | `1001`
| *4.* ID de Grupo (**GID**) | ID del grupo primario | `1001`
| *5.* Comentario | Descripci√≥n o nombre completo | `Administrador de Sistemas`
| *6.* Directorio Home | Ruta donde inicia sesi√≥n el usuario | `/home/useradmin`
| *7.* Shell de Inicio | Programa que se ejecuta al iniciar sesi√≥n | `/bin/bash`
|===

=== 2. `/etc/shadow` (La Seguridad)

Almacena la informaci√≥n sensible de la contrase√±a. Solo el usuario *root* y los procesos con los permisos adecuados pueden leer este archivo por seguridad. Los campos m√°s importantes son el segundo (la *contrase√±a cifrada*) y los campos de pol√≠tica de caducidad.

=== 3. `/etc/group` (Las Pertenencias)

Lista los grupos definidos en el sistema. Cada l√≠nea tiene cuatro campos separados por dos puntos (`:`):

1.  **Nombre del grupo**
2.  **Contrase√±a del grupo** (suele ser `x`)
3.  **GID** (ID √∫nico del grupo)
4.  **Lista de miembros** (usuarios que tienen este grupo como *secundario*, separados por comas)

== Elevaci√≥n de Privilegios: `sudo` y `/etc/sudoers` üëë

Un principio fundamental de seguridad es el *Principio de M√≠nimo Privilegio*. Los administradores no deben usar la cuenta de `root` para las tareas diarias. En su lugar, utilizamos el comando **`sudo`** (Super User DO) para ejecutar comandos con privilegios de otro usuario (normalmente `root`) solo cuando es necesario.

=== Uso de `sudo`

Para ejecutar un comando como `root`, simplemente antep√≥n `sudo` al comando:

[source,bash]
----
$ sudo systemctl restart apache2
----

Al usar `sudo` por primera vez en una sesi√≥n, se te pedir√° tu propia *contrase√±a de usuario*, no la de `root`.

=== El Archivo `/etc/sudoers`

¬øC√≥mo sabe el sistema qu√© usuarios pueden usar `sudo` y qu√© comandos est√°n autorizados a ejecutar? La respuesta est√° en el archivo `/etc/sudoers`.

* *Edici√≥n segura*: *Nunca* edites `/etc/sudoers` directamente con un editor como `vi` o `nano`. Utiliza siempre el comando **`visudo`**. Este comando valida la sintaxis del archivo antes de guardarlo, previniendo errores que podr√≠an bloquear la capacidad de elevar privilegios en el sistema.

* *Configuraci√≥n com√∫n*: La forma m√°s com√∫n de conceder permisos de `sudo` es a√±adiendo el usuario o un grupo (como el grupo `wheel` o `sudo` en algunas distribuciones) a este archivo, permiti√©ndoles ejecutar *cualquier* comando:

[source,bash]
----
%wheel ALL=(ALL) ALL
# O para un usuario espec√≠fico:
useradmin ALL=(ALL) ALL
----

Esta l√≠nea se traduce como: "Los miembros del grupo `wheel` (o el usuario `useradmin`) pueden ejecutar comandos **en CUALQUIER _host_ de origen**, **como CUALQUIER usuario**, **ejecutando CUALQUIER comando**."

Dominar la gesti√≥n de usuarios y grupos es la base para administrar un sistema Linux seguro y bien organizado. ¬°Practica estos comandos en tu laboratorio y estar√°s un paso m√°s cerca de tu certificaci√≥n!

== Ejercicio Avanzado: Creando un Usuario "Manualmente" (El Flujo de `useradd`)

image::images/useradd_flow.png[El flujo de useradd]

Aunque `useradd` es la herramienta est√°ndar, entender lo que sucede "bajo el cap√≥" te dar√° una perspectiva mucho m√°s profunda de c√≥mo Linux gestiona las cuentas de usuario. Este ejercicio te guiar√° a trav√©s de los mismos pasos que el comando `useradd` realiza internamente.

*¬°Advertencia Importante!* Este ejercicio es para fines **estrictamente educativos** en un entorno de laboratorio o m√°quina virtual. En un sistema de producci√≥n, **siempre** debes usar los comandos est√°ndar (`useradd`, `passwd`, `groupadd`, `usermod`, etc.) para evitar errores de sintaxis, inconsistencias en el sistema o problemas de seguridad.

Para este ejercicio, todos los comandos y tareas deben ejecutarse con privilegios de **`root`** (ya sea directamente como `root` o utilizando `sudo`).

=== El Flujo de `useradd` Replicado Manualmente:

Cuando ejecutas el comando `useradd <nombre_usuario>`, el binario `/usr/sbin/useradd` realiza una serie de pasos. A continuaci√≥n, vamos a replicar ese proceso manualmente para un nuevo usuario llamado `manualuser`.

***

.*Paso 0: Preparaci√≥n (como `root`)*

Antes de empezar, abre una terminal y aseg√∫rate de tener privilegios de `root` con `sudo`.

[source,bash]
----
$ sudo -i
----

***

.Paso 1: Lectura de Configuraciones por Defecto desde `/etc/login.defs`*

El comando `useradd` primero lee el archivo `/etc/login.defs` para obtener las configuraciones por defecto del sistema, como rangos de UID/GID, umask, y pol√≠ticas de caducidad de contrase√±as.

* *Tu tarea (exploraci√≥n):* Revisa este archivo para familiarizarte con las configuraciones que `useradd` utilizar√≠a.
+
[source,bash]
----
# grep -E "UID_MIN|GID_MIN|UMASK|PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE" /etc/login.defs
----
+
An√≥tate el `UID_MIN` y `GID_MIN` para usarlos en los siguientes pasos. Para este ejemplo, asumiremos que el siguiente UID/GID disponible para `manualuser` es `1001`.

***

.Paso 2: Creaci√≥n de Entradas en Archivos Clave de Configuraci√≥n*

Ahora, crearemos las entradas correspondientes para `manualuser` en los archivos `/etc/group`, `/etc/passwd` y `/etc/shadow`.

* *2a. Crear el Grupo Primario en `/etc/group`:*
`useradd` por defecto crea un grupo con el mismo nombre que el usuario y lo asigna como grupo primario. Vamos a crear el grupo `manualuser` con el GID `1001`.
+
[source,bash]
----
# echo "manualuser:x:1001:" >> /etc/group
# cat /etc/group | tail -n 1 <1>
----
+
<1> Para verificar.

* *2b. Crear la Entrada del Usuario en `/etc/passwd`:*
Aqu√≠ definimos la informaci√≥n b√°sica del usuario. Usaremos el UID `1001`, el GID primario `1001`, y el shell `/bin/bash`.
+
[source,bash]
----
# echo "manualuser:x:1001:1001:Usuario Creado Manualmente:/home/manualuser:/bin/bash" >> /etc/passwd
# cat /etc/passwd | tail -n 1 <1>
----
+
<1> Para verificar.

* *2c. Crear la Entrada de la Contrase√±a en `/etc/shadow`:*
Esta es la parte m√°s delicada. Necesitamos una contrase√±a cifrada. En lugar de cifrarla manualmente, podemos generar una vac√≠a o usar una existente. Para simplificar, crearemos una entrada inicial y luego usaremos `passwd` para establecer la contrase√±a (como har√≠a `useradd` o un administrador).
+
[source,bash]
----

# echo "manualuser:!:19000:0:99999:7:::" >> /etc/shadow <1><2><3>
# cat /etc/shadow | tail -n 1 <4><5>
----
+
<1> La cadena vac√≠a "!" o "*" indica una cuenta bloqueada o sin contrase√±a, forzando a establecerla
<2> La "x" en /etc/passwd ya indica que la contrase√±a est√° en /etc/shadow.
<3> Aqu√≠, usaremos una entrada temporal para que 'passwd' pueda trabajar con ella.
<4> El '!' significa que la cuenta est√° bloqueada o sin contrase√±a v√°lida inicial.
<5> Para verificar.

***

.*Paso 3: Creaci√≥n y Configuraci√≥n del Directorio Home*

El directorio *home* es donde el usuario almacena sus archivos personales.

* *3a. Crear el Directorio Home:*
+
[source,bash]
----
# mkdir /home/manualuser
----

* *3b. Copiar Archivos de `/etc/skel`:*
`/etc/skel` contiene archivos de configuraci√≥n por defecto (como `.bashrc`, `.profile`) que se copian al nuevo directorio *home*.
+
[source,bash]
----
# cp -r /etc/skel/. /home/manualuser/
----

* *3c. Establecer Permisos y Propiedad:*
El directorio *home* y su contenido deben pertenecer al nuevo usuario y su grupo primario, con permisos adecuados.
+
[source,bash]
----
# chown -R manualuser:manualuser /home/manualuser
# chmod 700 /home/manualuser <1>
ls -ld /home/manualuser <2>
----
+
<1> Permisos b√°sicos: solo el usuario puede leer/escribir/ejecutar
<2> Para verificar

***

.*Paso 4: Establecer la Contrase√±a del Nuevo Usuario*

Aunque ya creamos la entrada en `/etc/shadow`, el cifrado de la contrase√±a real y la configuraci√≥n de las pol√≠ticas de caducidad se hace con el comando `passwd`.

[source,bash]
----
# passwd manualuser
----

Se te pedir√° que introduzcas y confirmes una nueva contrase√±a para `manualuser`. Una vez hecha, `passwd` actualizar√° la l√≠nea de `manualuser` en `/etc/shadow` con la contrase√±a cifrada y los datos de caducidad.

**‚≠ê Tip Avanzado para Contrase√±as:**
Para este ejercicio, si quieres evitar el paso interactivo de `passwd` y ya conoces la contrase√±a cifrada de un usuario existente (por ejemplo, `testuser`) puedes copiar y adaptar su l√≠nea de `/etc/shadow`.

1.  **Obt√©n la l√≠nea de un usuario existente:**
+
[source,bash]
----
# grep testuser /etc/shadow
----

    Esto te dar√° algo como: `testuser:$6$SALTCIFRADO$...:19000:0:99999:7:::`

2.  **Edita la entrada de `manualuser` en `/etc/shadow`:**
    Puedes usar `sed` o un editor de texto (con mucho cuidado) para reemplazar la `!` por la parte cifrada de la contrase√±a.
    Por ejemplo, si la parte cifrada de `testuser` es `$6$SALTCIFRADO$...`, la copiar√≠as para `manualuser`.
    **¬°MUCHO CUIDADO AL EDITAR `/etc/shadow`! Un error puede bloquear inicios de sesi√≥n.**
+
[source,bash]
----
# sed -i 's/^manualuser:!: manualuser:<HASH_DE_CONTRASE√ëA_CIFRADA>:19000:0:99999:7:::/' /etc/shadow <1>
----
+
<1> # Ejemplo (reemplaza <HASH_DE_CONTRASE√ëA_CIFRADA> con el hash real copiado)

    Si haces esto correctamente, la misma contrase√±a que usas para `testuser` (o el usuario de donde copiaste el hash) deber√≠a funcionar para `manualuser`.

***

.*Paso 5: Verificar el Acceso al Sistema*

Este es el paso m√°s importante para asegurarnos de que todo el trabajo manual ha sido correcto. Para comprobarlo, debemos intentar iniciar sesi√≥n como `manualuser`.

* *Opci√≥n A: Desde otra terminal con SSH (Recomendado):*
Abre una nueva terminal (en tu m√°quina anfitriona o en otra VM) e intenta conectarte v√≠a SSH. Esto simula un inicio de sesi√≥n real.
+
[source,bash]
----
$ ssh manualuser@<DIRECCI√ìN_IP_DE_TU_SERVIDOR_LINUX>
----

    Ingresa la contrase√±a que estableciste en el Paso 4. Si el inicio de sesi√≥n es exitoso, ¬°lo has logrado!

* *Opci√≥n B: Cambiar de usuario desde un usuario sin privilegios:*
Si no puedes usar SSH, puedes cambiar a un usuario sin privilegios administrativos (si tienes uno) y luego intentar `su` al nuevo usuario.
+
[source,bash]
----
# exit <1>
logout
$ su - manualuser
----
+
<1> Primero, sal de tu sesi√≥n de `root` si est√°s en ella.
<2> Desde tu usuario normal (no `root`), intenta cambiar al nuevo usuario.

    Ingresa la contrase√±a cuando se te solicite. Si accedes, puedes verificar que est√°s en su *home* con `pwd` y ver su UID/GID con `id`.

***

¬°Felicidades! Has completado la creaci√≥n manual de un usuario, entendiendo a fondo los componentes que `useradd` maneja por ti. Este es un conocimiento valioso para cualquier administrador de sistemas Linux.

¬°Comparte tus resultados y cualquier desaf√≠o que hayas encontrado en los comentarios! Nos encantar√≠a saber c√≥mo te fue con este ejercicio.

***

== Invitaci√≥n a la Comunidad üöÄ

Este *post* forma parte de una serie dedicada a la arquitectura y administraci√≥n de sistemas Linux. ¬°Queremos construir el mejor recurso posible *con tu ayuda*!

Te invitamos a:

* *Clonar el Repositorio:* El c√≥digo fuente de todos nuestros art√≠culos est√° disponible en *GitHub*.
* *Contribuir:* Si encuentras alg√∫n error, tienes sugerencias para mejorar la claridad de los conceptos o deseas proponer correcciones t√©cnicas, no dudes en enviar un *Pull Request* (Solicitud de extracci√≥n).
* *Comentar:* ¬øTienes una pregunta o un punto de vista diferente sobre alg√∫n concepto? Abre un *Issue* (Incidencia) en el repositorio para iniciar la discusi√≥n.

Tu colaboraci√≥n es vital para mantener este contenido preciso y actualizado.

*¬°Encuentra el repositorio y participa aqu√≠:* link:https://github.com/rootzilopochtli/introduccion-a-linux[github.com/rootzilopochtli/introduccion-a-linux]
