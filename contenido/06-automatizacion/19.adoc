= SELinux y AppArmor (Control de Acceso Obligatorio)
:author: Alex Callejas
:doctype: article
:revdate: Oct 24, 2025
:keywords: SELinux, AppArmor, MAC, RHCSA, LFCS, RH134, Seguridad Linux

image::images/portada_19.png[]

== üõ°Ô∏è Seguridad Reforzada en Linux: SELinux y AppArmor (Control de Acceso Obligatorio)

En el mundo de la administraci√≥n de sistemas Linux, la *seguridad* es primordial. M√°s all√° de las herramientas de control de acceso discrecional (DAC) como los permisos de archivo tradicionales, los administradores profesionales recurren a mecanismos de seguridad m√°s robustos, como los **Modelos de Control de Acceso Obligatorio (MAC)**. Este concepto es central en certificaciones avanzadas como **RHCSA** (particularmente el m√≥dulo **RH134**) y **LFCS**, que preparan a los profesionales para implementar seguridad a nivel empresarial.

***

=== üõ°Ô∏è Introducci√≥n a los Modelos de Control de Acceso Obligatorio (MAC)

El **Control de Acceso Obligatorio (MAC)** es un modelo de seguridad donde el sistema operativo (SO) restringe la capacidad de un sujeto (como un usuario o un proceso) para acceder o realizar alguna operaci√≥n en un objeto (como un archivo o un dispositivo de red). A diferencia del **Control de Acceso Discrecional (DAC)**, donde el propietario del recurso establece los permisos, en MAC es el **administrador central** o la **pol√≠tica de seguridad del SO** quien determina el acceso, y el propietario no puede anular esas reglas.

MAC ofrece un nivel de protecci√≥n superior porque:

1.  **A√≠sla procesos:** Si un proceso malicioso o comprometido intenta acceder a recursos fuera de su √°mbito definido, el MAC lo bloquea inmediatamente, limitando el da√±o potencial.
2.  **Define el comportamiento:** Se establecen reglas que definen *exactamente* lo que un proceso puede hacer (y nada m√°s), adhiri√©ndose al principio de **m√≠nimo privilegio**.

Dos de las implementaciones de MAC m√°s conocidas en el ecosistema Linux son **SELinux** y **AppArmor**.

***

=== üî¥ SELinux: Security-Enhanced Linux (√ânfasis RHCSA/RH134)

**SELinux** (Security-Enhanced Linux) es el modelo MAC por defecto en distribuciones basadas en Red Hat (como RHEL, CentOS y Fedora), y su dominio es esencial para la certificaci√≥n RHCSA. SELinux funciona asignando un **contexto de seguridad** a cada archivo y proceso, y luego utilizando **pol√≠ticas** para definir c√≥mo los contextos pueden interactuar entre s√≠.

==== Modos de Operaci√≥n de SELinux

SELinux puede operar en tres modos principales, lo que permite a los administradores implementarlo de forma gradual y segura:

1.  **`Enforcing` (Obligatorio):** üö® **Modo de m√°xima seguridad.** Aplica activamente la pol√≠tica de seguridad. Si una acci√≥n est√° prohibida, **la niega** y registra un error (*audit log*).
2.  **`Permissive` (Permisivo):** ‚ö†Ô∏è **Modo de depuraci√≥n/prueba.** **No aplica** la pol√≠tica, lo que significa que **no niega** ninguna acci√≥n. Sin embargo, registra un *log* de lo que habr√≠a negado.
3.  **`Disabled` (Deshabilitado):** üö´ **Modo inactivo.** SELinux est√° completamente apagado y no realiza ninguna verificaci√≥n ni registro de pol√≠ticas.

==== Comandos B√°sicos de Gesti√≥n de SELinux

Para la gesti√≥n diaria de SELinux, un administrador debe conocer los siguientes comandos:

|===
| Comando | Descripci√≥n

| **`sestatus`**
| Muestra el estado actual de SELinux: el modo, la pol√≠tica que se est√° cargando, y si est√° activado o no.

| **`getenforce`**
| Muestra de forma concisa el modo actual de SELinux (ej. *Enforcing* o *Permissive*).

| **`setenforce [0\|1]`**
| Cambia el modo de operaci√≥n **temporalmente** sin reiniciar. `1` establece el modo *Enforcing*. `0` establece el modo *Permissive*.

| **`semanage`**
| Herramienta avanzada para modificar la pol√≠tica de SELinux (ej. puertos, tipos de contexto de archivo, etc.).

| **`chcon`**
| Cambia el contexto de seguridad SELinux de archivos/directorios.

| **`restorecon`**
| Restablece el contexto de seguridad de un archivo/directorio a su valor predeterminado seg√∫n la pol√≠tica.
|===

==== Ejemplo Pr√°ctico: El Servicio HTTPD (Apache)

Para entender c√≥mo funciona SELinux, veamos el ejemplo del servicio web **HTTPD** (Apache). SELinux asigna un **contexto de seguridad** (una etiqueta) a cada componente del servicio.

La regla fundamental que se aplica aqu√≠ es:
[quote, Pol√≠tica SELinux]
Un proceso que se ejecuta en el contexto `httpd_t` s√≥lo puede interactuar (leer, escribir, ejecutar, etc.) con objetos que tengan una etiqueta que la pol√≠tica permita espec√≠ficamente, como `httpd_algo_t`.

A continuaci√≥n se muestran los contextos (tipos) t√≠picos asignados a los componentes de HTTPD en RHEL, todos compartiendo la "cabecera" `httpd_`:

|===
| Componente | Ruta de Archivo/Proceso | Contexto (Tipo) T√≠pico

| **Proceso (Dominio)**
| `/usr/sbin/httpd -DFOREGROUND`
| `httpd_t`

| **Binario Principal**
| `/usr/sbin/httpd`
| `httpd_exec_t`

| **Archivos de Configuraci√≥n**
| `/etc/httpd`
| `httpd_config_t`

| **Directorios de Contenido**
| `/var/www/html`
| `httpd_sys_content_t`

| **Archivos de Logs**
| `/var/log/httpd`
| `httpd_log_t`

| **Startup Script (systemd)**
| `/usr/lib/systemd/system/httpd.service`
| `systemd_unit_file_t`

| **Puertos de Red**
| `80/tcp`, `443/tcp`
| `http_port_t`
|===

El poder de SELinux reside en esta separaci√≥n:

* El proceso (`httpd_t`) tiene permiso para leer archivos con la etiqueta `httpd_config_t` y `httpd_sys_content_t`.
* El proceso (`httpd_t`) tiene permiso para escribir en archivos con la etiqueta `httpd_log_t`.
* **Implicaci√≥n de seguridad:** Si un atacante compromete el servicio HTTPD, el proceso malicioso *a√∫n* se ejecuta como `httpd_t`. Si ese proceso intenta leer un archivo sensible como `/etc/shadow` (que tiene el contexto `shadow_t`), **SELinux lo bloquea**. Aunque los permisos DAC (tradicionales de Linux) del archivo `/etc/shadow` pudieran permitir la lectura por el usuario `apache`, la pol√≠tica MAC de SELinux lo **obligar√°** a negarse porque la regla: "El proceso `httpd_t` puede leer el archivo `shadow_t` " no existe.

***

=== üõ°Ô∏è SELinux vs. AppArmor: Comparaci√≥n de MAC en Linux

Mientras que SELinux es prominente en RHEL, **AppArmor** es el sistema MAC preferido en distribuciones como Ubuntu y SUSE. Ambos cumplen la funci√≥n de Control de Acceso Obligatorio, pero tienen enfoques y arquitecturas diferentes.

[cols="1,1,1"]
|===
| Caracter√≠stica | SELinux (Security-Enhanced Linux) | AppArmor (Application Armor)

| **Modelo de Seguridad**
| Basado en **Tipos (Type Enforcement)**. El acceso se basa en el **contexto de seguridad** (Tipo) del proceso y del recurso.
| Basado en **Rutas de Archivo (Path-Based)**. El acceso se define a trav√©s de rutas de archivos, de forma similar al DAC.

| **Complejidad**
| Mayor. Curva de aprendizaje m√°s pronunciada debido a la asignaci√≥n de contextos (Tipo, Rol, Usuario, Sensibilidad).
| Menor. Las reglas son m√°s intuitivas y legibles, basadas en rutas y permisos de estilo DAC (r, w, k, etc.).

| **Implementaci√≥n**
| Por defecto en **RHEL/CentOS/Fedora**. Integrado con las etiquetas de contexto del sistema de archivos.
| Por defecto en **Ubuntu/SUSE**. Utiliza perfiles almacenados en el sistema de archivos.

| **Granularidad**
| Muy alta. Permite un control extremadamente fino sobre cada interacci√≥n del proceso con el sistema.
| Alta. Proporciona un buen nivel de control, pero puede ser menos detallado que SELinux en escenarios complejos.
|===

**Conclusi√≥n:** Tanto SELinux como AppArmor proporcionan una capa de seguridad crucial para un sistema Linux. SELinux (**RHCSA/RH134**) es la opci√≥n m√°s poderosa y granular. AppArmor (**LFCS**) ofrece una alternativa m√°s sencilla de auditar y mantener. Dominar al menos uno de estos sistemas MAC es una habilidad esencial para cualquier administrador certificado.


// Enlace de la publicaci√≥n original (para versiones fuera de GitHub)
// link:https://www.rootzilopochtli.com/seguridad-reforzada-en-linux [Publicaci√≥n Original del Blog]

***

== Invitaci√≥n a la Comunidad üöÄ

Este *post* forma parte de una serie dedicada a la arquitectura y administraci√≥n de sistemas Linux. ¬°Queremos construir el mejor recurso posible *con tu ayuda*!

Te invitamos a:

* *Clonar el Repositorio:* El c√≥digo fuente de todos nuestros art√≠culos est√° disponible en *GitHub*.
* *Contribuir:* Si encuentras alg√∫n error, tienes sugerencias para mejorar la claridad de los conceptos o deseas proponer correcciones t√©cnicas, no dudes en enviar un *Pull Request* (Solicitud de extracci√≥n).
* *Comentar:* ¬øTienes una pregunta o un punto de vista diferente sobre alg√∫n concepto? Abre un *Issue* (Incidencia) en el repositorio para iniciar la discusi√≥n.

Tu colaboraci√≥n es vital para mantener este contenido preciso y actualizado.

*¬°Encuentra el repositorio y participa aqu√≠:* link:https://github.com/rootzilopochtli/introduccion-a-linux[github.com/rootzilopochtli/introduccion-a-linux]